generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
}

model Roles {
  id         Int      @id @default(autoincrement())
  name       String   @unique
  users      Users[]
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
}

model Users {
  id               Int        @id @default(autoincrement())
  name             String
  email            String     @unique
  password         String
  role_id          Int
  role             Roles      @relation(fields: [role_id], references: [id])
  customers        Customers[]
  items            Items[]
  invoices         Invoices[]
  estimates        Estimates[]
  expenses         Expenses[]
  created_at       DateTime   @default(now())
  updated_at       DateTime   @updatedAt
  email_verified_at DateTime?
  remember_token   String?
}

model Customers {
  id         Int        @id @default(autoincrement())
  user_id    Int
  user       Users      @relation(fields: [user_id], references: [id], onDelete: Cascade)
  name       String
  email      String?
  phone      String?
  address    String?
  city       String?
  postcode   String?
  country    String?    @default("United Kingdom")
  notes      String?
  invoices   Invoices[]
  estimates  Estimates[]
  expenses   Expenses[]
  created_at DateTime   @default(now())
  updated_at DateTime   @updatedAt
}

model Items {
  id             Int            @id @default(autoincrement())
  user_id        Int
  user           Users          @relation(fields: [user_id], references: [id], onDelete: Cascade)
  name           String
  description    String?
  unit_price     Decimal        @db.Decimal(10, 2)
  unit           String?        @default("unit")
  tax_rate       Decimal?       @db.Decimal(5, 2) @default(0)
  invoice_items  InvoiceItems[]
  estimate_items EstimateItems[]
  created_at     DateTime       @default(now())
  updated_at     DateTime       @updatedAt
}

model Invoices {
  id             Int            @id @default(autoincrement())
  user_id        Int
  user           Users          @relation(fields: [user_id], references: [id], onDelete: Cascade)
  customer_id    Int
  customer       Customers      @relation(fields: [customer_id], references: [id], onDelete: Cascade)
  invoice_number String         @unique
  issue_date     DateTime       @default(now())
  due_date       DateTime
  status         InvoiceStatus  @default(DRAFT)
  subtotal       Decimal        @db.Decimal(10, 2) @default(0)
  tax_amount     Decimal        @db.Decimal(10, 2) @default(0)
  total          Decimal        @db.Decimal(10, 2) @default(0)
  notes          String?
  items          InvoiceItems[]
  created_at     DateTime       @default(now())
  updated_at     DateTime       @updatedAt
}

enum InvoiceStatus {
  DRAFT
  SENT
  PAID
  OVERDUE
  CANCELLED
}

model InvoiceItems {
  id          Int      @id @default(autoincrement())
  invoice_id  Int
  invoice     Invoices @relation(fields: [invoice_id], references: [id], onDelete: Cascade)
  item_id     Int?
  item        Items?   @relation(fields: [item_id], references: [id], onDelete: SetNull)
  description String
  quantity    Decimal  @db.Decimal(10, 2)
  unit_price  Decimal  @db.Decimal(10, 2)
  tax_rate    Decimal  @db.Decimal(5, 2) @default(0)
  total       Decimal  @db.Decimal(10, 2)
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt
}

model Estimates {
  id              Int            @id @default(autoincrement())
  user_id         Int
  user            Users          @relation(fields: [user_id], references: [id], onDelete: Cascade)
  customer_id     Int
  customer        Customers      @relation(fields: [customer_id], references: [id], onDelete: Cascade)
  estimate_number String         @unique
  issue_date      DateTime       @default(now())
  expiry_date     DateTime
  status          EstimateStatus @default(DRAFT)
  subtotal        Decimal        @db.Decimal(10, 2) @default(0)
  tax_amount      Decimal        @db.Decimal(10, 2) @default(0)
  total           Decimal        @db.Decimal(10, 2) @default(0)
  notes           String?
  items           EstimateItems[]
  created_at      DateTime       @default(now())
  updated_at      DateTime       @updatedAt
}

enum EstimateStatus {
  DRAFT
  SENT
  ACCEPTED
  REJECTED
  EXPIRED
}

model EstimateItems {
  id          Int       @id @default(autoincrement())
  estimate_id Int
  estimate    Estimates @relation(fields: [estimate_id], references: [id], onDelete: Cascade)
  item_id     Int?
  item        Items?    @relation(fields: [item_id], references: [id], onDelete: SetNull)
  description String
  quantity    Decimal   @db.Decimal(10, 2)
  unit_price  Decimal   @db.Decimal(10, 2)
  tax_rate    Decimal   @db.Decimal(5, 2) @default(0)
  total       Decimal   @db.Decimal(10, 2)
  created_at  DateTime  @default(now())
  updated_at  DateTime  @updatedAt
}

model Expenses {
  id          Int             @id @default(autoincrement())
  user_id     Int
  user        Users           @relation(fields: [user_id], references: [id], onDelete: Cascade)
  customer_id Int?
  customer    Customers?      @relation(fields: [customer_id], references: [id], onDelete: SetNull)
  category    ExpenseCategory
  description String
  amount      Decimal         @db.Decimal(10, 2)
  tax_amount  Decimal         @db.Decimal(10, 2) @default(0)
  date        DateTime        @default(now())
  receipt     String?
  notes       String?
  created_at DateTime         @default(now())
  updated_at DateTime         @updatedAt
}

enum ExpenseCategory {
  OFFICE_SUPPLIES
  TRAVEL
  UTILITIES
  RENT
  MARKETING
  SOFTWARE
  EQUIPMENT
  PAYROLL
  PROFESSIONAL_SERVICES
  INSURANCE
  TAXES
  OTHER
}
