generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Role {
  id        Int      @id @default(autoincrement())
  name      String   @unique
  users     User[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model User {
  id            Int        @id @default(autoincrement())
  name          String
  email         String     @unique
  password      String
  roleId        Int
  role          Role       @relation(fields: [roleId], references: [id])
  customers     Customer[]
  items         Item[]
  invoices      Invoice[]
  estimates     Estimate[]
  expenses      Expense[]
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  emailVerifiedAt DateTime?
  rememberToken String?
}

model Customer {
  id          Int        @id @default(autoincrement())
  userId      Int
  user        User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  name        String
  email       String?
  phone       String?
  address     String?
  city        String?
  postcode    String?
  country     String?    @default("United Kingdom")
  notes       String?
  invoices    Invoice[]
  estimates   Estimate[]
  expenses    Expense[]
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
}

model Item {
  id            Int           @id @default(autoincrement())
  userId        Int
  user          User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  name          String
  description   String?
  unitPrice     Decimal       @db.Decimal(10, 2)
  unit          String?       @default("unit")
  taxRate       Decimal?      @db.Decimal(5, 2) @default(0)
  invoiceItems  InvoiceItem[]
  estimateItems EstimateItem[]
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
}

model Invoice {
  id            Int           @id @default(autoincrement())
  userId        Int
  user          User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  customerId    Int
  customer      Customer      @relation(fields: [customerId], references: [id], onDelete: Cascade)
  invoiceNumber String        @unique
  issueDate     DateTime      @default(now())
  dueDate       DateTime
  status        InvoiceStatus @default(DRAFT)
  subtotal      Decimal       @db.Decimal(10, 2) @default(0)
  taxAmount     Decimal       @db.Decimal(10, 2) @default(0)
  total         Decimal       @db.Decimal(10, 2) @default(0)
  notes         String?
  items         InvoiceItem[]
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
}

enum InvoiceStatus {
  DRAFT
  SENT
  PAID
  OVERDUE
  CANCELLED
}

model InvoiceItem {
  id          Int      @id @default(autoincrement())
  invoiceId   Int
  invoice     Invoice  @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  itemId      Int?
  item        Item?    @relation(fields: [itemId], references: [id], onDelete: SetNull)
  description String
  quantity    Decimal  @db.Decimal(10, 2)
  unitPrice   Decimal  @db.Decimal(10, 2)
  taxRate     Decimal  @db.Decimal(5, 2) @default(0)
  total       Decimal  @db.Decimal(10, 2)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Estimate {
  id             Int            @id @default(autoincrement())
  userId         Int
  user           User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  customerId     Int
  customer       Customer       @relation(fields: [customerId], references: [id], onDelete: Cascade)
  estimateNumber String         @unique
  issueDate      DateTime       @default(now())
  expiryDate     DateTime
  status         EstimateStatus @default(DRAFT)
  subtotal       Decimal        @db.Decimal(10, 2) @default(0)
  taxAmount      Decimal        @db.Decimal(10, 2) @default(0)
  total          Decimal        @db.Decimal(10, 2) @default(0)
  notes          String?
  items          EstimateItem[]
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
}

enum EstimateStatus {
  DRAFT
  SENT
  ACCEPTED
  REJECTED
  EXPIRED
}

model EstimateItem {
  id          Int      @id @default(autoincrement())
  estimateId  Int
  estimate    Estimate @relation(fields: [estimateId], references: [id], onDelete: Cascade)
  itemId      Int?
  item        Item?    @relation(fields: [itemId], references: [id], onDelete: SetNull)
  description String
  quantity    Decimal  @db.Decimal(10, 2)
  unitPrice   Decimal  @db.Decimal(10, 2)
  taxRate     Decimal  @db.Decimal(5, 2) @default(0)
  total       Decimal  @db.Decimal(10, 2)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Expense {
  id          Int             @id @default(autoincrement())
  userId      Int
  user        User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  customerId  Int?
  customer    Customer?       @relation(fields: [customerId], references: [id], onDelete: SetNull)
  category    ExpenseCategory
  description String
  amount      Decimal         @db.Decimal(10, 2)
  taxAmount   Decimal         @db.Decimal(10, 2) @default(0)
  date        DateTime        @default(now())
  receipt     String?
  notes       String?
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
}

enum ExpenseCategory {
  OFFICE_SUPPLIES
  TRAVEL
  UTILITIES
  RENT
  MARKETING
  SOFTWARE
  EQUIPMENT
  PAYROLL
  PROFESSIONAL_SERVICES
  INSURANCE
  TAXES
  OTHER
}
