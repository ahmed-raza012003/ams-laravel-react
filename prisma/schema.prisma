generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
}

model Roles {
  id         Int      @id @default(autoincrement())
  name       String   @unique
  users      Users[]
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
}

model Users {
  id               Int        @id @default(autoincrement())
  name             String
  email            String     @unique
  password         String
  role_id          Int
  role             Roles      @relation(fields: [role_id], references: [id])
  customers        Customers[]
  items            Items[]
  invoices         Invoices[]
  estimates        Estimates[]
  expenses         Expenses[]
  tax_types        TaxType[]
  created_at       DateTime   @default(now())
  updated_at       DateTime   @updatedAt
  email_verified_at DateTime?
  remember_token   String?
}

model Customers {
  id         Int        @id @default(autoincrement())
  user_id    Int
  user       Users      @relation(fields: [user_id], references: [id], onDelete: Cascade)
  name       String
  email      String?
  phone      String?
  address    String?
  city       String?
  postcode   String?
  country    String?    @default("United Kingdom")
  notes      String?
  invoices   Invoices[]
  estimates  Estimates[]
  expenses   Expenses[]
  created_at DateTime   @default(now())
  updated_at DateTime   @updatedAt
}

model Items {
  id                Int            @id @default(autoincrement())
  user_id           Int
  user              Users          @relation(fields: [user_id], references: [id], onDelete: Cascade)
  name              String
  item_code         String?
  description       String?
  stock_quantity    Decimal        @db.Decimal(10, 2) @default(0)
  unit              String?        @default("unit")
  purchase_date     DateTime?
  purchase_price    Decimal?       @db.Decimal(10, 2)
  unit_price        Decimal        @db.Decimal(10, 2)
  sales_price       Decimal?       @db.Decimal(10, 2)
  manufacturer      String?
  warranty_info     String?
  notes             String?
  item_category_id  Int?
  item_category     ItemCategory?  @relation(fields: [item_category_id], references: [id], onDelete: SetNull)
  tax_types         ItemTaxType[]
  invoice_items     InvoiceItems[]
  estimate_items    EstimateItems[]
  created_at        DateTime       @default(now())
  updated_at        DateTime       @updatedAt
}

model Invoices {
  id               Int            @id @default(autoincrement())
  user_id          Int
  user             Users          @relation(fields: [user_id], references: [id], onDelete: Cascade)
  customer_id      Int
  customer         Customers      @relation(fields: [customer_id], references: [id], onDelete: Cascade)
  invoice_number   String         @unique
  issue_date       DateTime       @default(now())
  due_date         DateTime
  status           InvoiceStatus  @default(DRAFT)
  sales_category_id Int?
  sales_category   SalesCategory? @relation(fields: [sales_category_id], references: [id], onDelete: SetNull)
  subtotal         Decimal        @db.Decimal(10, 2) @default(0)
  tax_amount       Decimal        @db.Decimal(10, 2) @default(0)
  total            Decimal        @db.Decimal(10, 2) @default(0)
  notes            String?
  items            InvoiceItems[]
  created_at       DateTime       @default(now())
  updated_at       DateTime       @updatedAt
}

enum InvoiceStatus {
  DRAFT
  PENDING
  OPEN
  PARTIALLY_PAID
  PAID
  OVERDUE
  UNPAID
  VOID
  REFUNDED
}

model InvoiceItems {
  id          Int      @id @default(autoincrement())
  invoice_id  Int
  invoice     Invoices @relation(fields: [invoice_id], references: [id], onDelete: Cascade)
  item_id     Int?
  item        Items?   @relation(fields: [item_id], references: [id], onDelete: SetNull)
  description String
  quantity    Decimal  @db.Decimal(10, 2)
  unit_price  Decimal  @db.Decimal(10, 2)
  tax_rate    Decimal  @db.Decimal(5, 2) @default(0)
  total       Decimal  @db.Decimal(10, 2)
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt
}

model Estimates {
  id               Int            @id @default(autoincrement())
  user_id          Int
  user             Users          @relation(fields: [user_id], references: [id], onDelete: Cascade)
  customer_id      Int
  customer         Customers      @relation(fields: [customer_id], references: [id], onDelete: Cascade)
  estimate_number  String         @unique
  issue_date       DateTime       @default(now())
  expiry_date      DateTime
  status           EstimateStatus @default(DRAFT)
  sales_category_id Int?
  sales_category   SalesCategory? @relation(fields: [sales_category_id], references: [id], onDelete: SetNull)
  subtotal         Decimal        @db.Decimal(10, 2) @default(0)
  tax_amount       Decimal        @db.Decimal(10, 2) @default(0)
  total            Decimal        @db.Decimal(10, 2) @default(0)
  notes            String?
  items            EstimateItems[]
  created_at       DateTime       @default(now())
  updated_at       DateTime       @updatedAt
}

enum EstimateStatus {
  DRAFT
  PENDING_REVIEW
  UNDER_REVIEW
  APPROVED
  REJECTED
  ON_HOLD
  COMPLETED
  CANCELLED
}

model EstimateItems {
  id          Int       @id @default(autoincrement())
  estimate_id Int
  estimate    Estimates @relation(fields: [estimate_id], references: [id], onDelete: Cascade)
  item_id     Int?
  item        Items?    @relation(fields: [item_id], references: [id], onDelete: SetNull)
  description String
  quantity    Decimal   @db.Decimal(10, 2)
  unit_price  Decimal   @db.Decimal(10, 2)
  tax_rate    Decimal   @db.Decimal(5, 2) @default(0)
  total       Decimal   @db.Decimal(10, 2)
  created_at  DateTime  @default(now())
  updated_at  DateTime  @updatedAt
}

model Expenses {
  id                 Int              @id @default(autoincrement())
  user_id            Int
  user               Users             @relation(fields: [user_id], references: [id], onDelete: Cascade)
  customer_id        Int?
  customer           Customers?        @relation(fields: [customer_id], references: [id], onDelete: SetNull)
  expense_category_id Int?
  expense_category   ExpenseCategory?  @relation(fields: [expense_category_id], references: [id], onDelete: SetNull)
  description        String
  amount             Decimal           @db.Decimal(10, 2)
  tax_amount         Decimal           @db.Decimal(10, 2) @default(0)
  date               DateTime          @default(now())
  receipt            String?
  notes              String?
  created_at         DateTime          @default(now())
  updated_at         DateTime          @updatedAt
}

model ItemCategory {
  id         Int      @id @default(autoincrement())
  title      String
  description String?
  items      Items[]
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
}

model ExpenseCategory {
  id         Int        @id @default(autoincrement())
  title      String
  description String?
  expenses   Expenses[]
  created_at DateTime   @default(now())
  updated_at DateTime   @updatedAt
}

model SalesCategory {
  id         Int        @id @default(autoincrement())
  title      String
  description String?
  invoices   Invoices[]
  estimates  Estimates[]
  created_at DateTime   @default(now())
  updated_at DateTime   @updatedAt
}

model TaxType {
  id         Int          @id @default(autoincrement())
  user_id    Int
  user       Users        @relation(fields: [user_id], references: [id], onDelete: Cascade)
  title      String
  rate       Decimal      @db.Decimal(5, 2)
  items      ItemTaxType[]
  created_at DateTime     @default(now())
  updated_at DateTime     @updatedAt
}

model ItemTaxType {
  id         Int      @id @default(autoincrement())
  item_id    Int
  item       Items    @relation(fields: [item_id], references: [id], onDelete: Cascade)
  tax_type_id Int
  tax_type   TaxType @relation(fields: [tax_type_id], references: [id], onDelete: Cascade)
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@unique([item_id, tax_type_id])
}
